<html xmlns:o="urn:schemas-microsoft-com:office:office"xmlns:w="urn:schemas-microsoft-com:office:word"xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=Title content="Cache Strategy:"><meta name=Keywords content=""><meta http-equiv=Content-Type content="text/html; charset=macintosh"><meta name=ProgId content=Word.Document><meta name=Generator content="Microsoft Word 11"><meta name=Originator content="Microsoft Word 11"><link rel=File-List href="STLdb%20High%20Level%20Design_files/filelist.xml"><title>Cache Strategy:</title><!--[if gte mso 9]><xml> <o:DocumentProperties>  <o:Author>Bob Walters</o:Author>  <o:Template>Normal</o:Template>  <o:LastAuthor>Bob Walters</o:LastAuthor>  <o:Revision>3</o:Revision>  <o:Created>2008-01-21T15:01:00Z</o:Created>  <o:LastSaved>2008-01-21T21:29:00Z</o:LastSaved>  <o:Pages>3</o:Pages>  <o:Words>3252</o:Words>  <o:Characters>18538</o:Characters>  <o:Company>Convergys</o:Company>  <o:Lines>154</o:Lines>  <o:Paragraphs>37</o:Paragraphs>  <o:CharactersWithSpaces>22765</o:CharactersWithSpaces>  <o:Version>11.773</o:Version> </o:DocumentProperties> <o:OfficeDocumentSettings>  <o:AllowPNG/> </o:OfficeDocumentSettings></xml><![endif]--><!--[if gte mso 9]><xml> <w:WordDocument>  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>  <w:DisplayVerticalDrawingGridEvery>0</w:DisplayVerticalDrawingGridEvery>  <w:UseMarginsForDrawingGridOrigin/> </w:WordDocument></xml><![endif]--><style><!-- /* Font Definitions */@font-face	{font-family:"Times New Roman";	panose-1:0 2 2 6 3 5 4 5 2 3;	mso-font-charset:0;	mso-generic-font-family:auto;	mso-font-pitch:variable;	mso-font-signature:50331648 0 0 0 1 0;} /* Style Definitions */p.MsoNormal, li.MsoNormal, div.MsoNormal	{mso-style-parent:"";	margin:0in;	margin-bottom:.0001pt;	mso-pagination:widow-orphan;	font-size:12.0pt;	font-family:"Times New Roman";}table.MsoNormalTable	{mso-style-parent:"";	font-size:10.0pt;	font-family:"Times New Roman";}@page Section1	{size:8.5in 11.0in;	margin:1.0in 1.25in 1.0in 1.25in;	mso-header-margin:.5in;	mso-footer-margin:.5in;	mso-paper-source:0;}div.Section1	{page:Section1;} /* List Definitions */@list l0	{mso-list-id:1;	mso-list-type:hybrid;	mso-list-template-ids:1 0 -1 -1 -1 -1 -1 -1 -1 -1;}@list l0:level1	{mso-level-text:"%6\.";	mso-level-tab-stop:none;	mso-level-number-position:right;	margin-left:0in;	text-indent:0in;}@list l0:level2	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l0:level3	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l0:level4	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l0:level5	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l0:level6	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l0:level7	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l0:level8	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l0:level9	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l1	{mso-list-id:2;	mso-list-type:hybrid;	mso-list-template-ids:2 0 -1 -1 -1 -1 -1 -1 -1 -1;}@list l1:level1	{mso-level-text:"%6\.";	mso-level-tab-stop:none;	mso-level-number-position:right;	margin-left:0in;	text-indent:0in;}@list l1:level2	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l1:level3	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l1:level4	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l1:level5	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l1:level6	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l1:level7	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l1:level8	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l1:level9	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l2	{mso-list-id:3;	mso-list-type:hybrid;	mso-list-template-ids:3 0 -1 -1 -1 -1 -1 -1 -1 -1;}@list l2:level1	{mso-level-number-format:bullet;	mso-level-text:"%6\.";	mso-level-tab-stop:none;	mso-level-number-position:right;	margin-left:0in;	text-indent:0in;}@list l2:level2	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l2:level3	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l2:level4	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l2:level5	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l2:level6	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l2:level7	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l2:level8	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l2:level9	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l3	{mso-list-id:4;	mso-list-type:hybrid;	mso-list-template-ids:4 0 -1 -1 -1 -1 -1 -1 -1 -1;}@list l3:level1	{mso-level-number-format:bullet;	mso-level-text:"%6\.";	mso-level-tab-stop:none;	mso-level-number-position:right;	margin-left:0in;	text-indent:0in;}@list l3:level2	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l3:level3	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l3:level4	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l3:level5	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l3:level6	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l3:level7	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l3:level8	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l3:level9	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l4	{mso-list-id:5;	mso-list-type:hybrid;	mso-list-template-ids:5 0 -1 -1 -1 -1 -1 -1 -1 -1;}@list l4:level1	{mso-level-number-format:bullet;	mso-level-text:"%6\.";	mso-level-tab-stop:none;	mso-level-number-position:right;	margin-left:0in;	text-indent:0in;}@list l4:level2	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l4:level3	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l4:level4	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l4:level5	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l4:level6	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l4:level7	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l4:level8	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l4:level9	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l5	{mso-list-id:6;	mso-list-type:hybrid;	mso-list-template-ids:6 0 -1 -1 -1 -1 -1 -1 -1 -1;}@list l5:level1	{mso-level-number-format:alpha-upper;	mso-level-text:"%6\.";	mso-level-tab-stop:none;	mso-level-number-position:right;	margin-left:0in;	text-indent:0in;}@list l5:level2	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l5:level3	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l5:level4	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l5:level5	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l5:level6	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l5:level7	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l5:level8	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l5:level9	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l6	{mso-list-id:241263110;	mso-list-type:hybrid;	mso-list-template-ids:2079645008 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}@list l6:level1	{mso-level-tab-stop:.5in;	mso-level-number-position:left;	text-indent:-.25in;}@list l7	{mso-list-id:1524132089;	mso-list-type:hybrid;	mso-list-template-ids:-494475298 67698703 -1 -1 -1 -1 -1 -1 -1 -1;}@list l7:level1	{mso-level-tab-stop:29.0pt;	mso-level-number-position:left;	margin-left:29.0pt;	text-indent:-.25in;}@list l7:level2	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l7:level3	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l7:level4	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l7:level5	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l7:level6	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l7:level7	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l7:level8	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l7:level9	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l8	{mso-list-id:1938442468;	mso-list-type:hybrid;	mso-list-template-ids:274073732 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}@list l8:level1	{mso-level-tab-stop:.5in;	mso-level-number-position:left;	text-indent:-.25in;}ol	{margin-bottom:0in;}ul	{margin-bottom:0in;}--></style></head><body bgcolor=white lang=EN-US style='tab-interval:.5in'><div class=Section1><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b><u><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></u></b></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:20.0pt;font-family:Helvetica'><b>High Level Design of STLdb</b></span><spanstyle='font-size:20.0pt;font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:16.0pt;font-family:Helvetica'><b>In-Memory Structure:</b></span><spanstyle='font-size:16.0pt;font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Ourapproach avoids the issue of paging. <span style="mso-spacerun:yes">&nbsp;</span>We employ a technique where a cache is loaded from a file(last snapshot) into an equivalent, in-memory data structure.<spanstyle="mso-spacerun: yes">&nbsp; </span>If one assumes that the data structureis always in-memory, then it becomes possible to limit the need for a pagingsubsystem to the act of initial loading, and transactional logging, followed bya subsequent shutdown.<span style="mso-spacerun: yes">&nbsp; </span>A sideeffect of the techniques described here is that ultimately, you do need a redolog to prevent data loss, but don’t end up needing an undo log.<spanstyle="mso-spacerun: yes">&nbsp; </span>It is easier to clean up after abortedtransactions (it doesn’t require reading the log for undo information), andthus it is easier to recover from a peer process demise.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Assumewe have a memory region implementation based on STLshm, and that the in-memoryrepresentation of the data structure is actually modeled as an STL containerwith a shared memory-based Allocator object as the basis for the class.<spanstyle="mso-spacerun: yes">&nbsp; </span>This would be the low-levelimplementation of the in-memory data structure (i.e. tables.)<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Thedata store is entirely accessed from memory, and as with TimesTen data stores,it must fit entirely within memory.<span style="mso-spacerun: yes">&nbsp;&nbsp;</span>There is no paging capability and associated LRU algorithm.<spanstyle="mso-spacerun: yes">&nbsp; </span>Thus, the in-memory data structures areoptimized for in-memory access.<span style="mso-spacerun: yes">&nbsp;&nbsp;</span>They should be as fast as mutexed heap memory structures.<spanstyle="mso-spacerun: yes">&nbsp; </span>When an object is read from sharedmemory, its copy constructor is invoked.<span style="mso-spacerun: yes">&nbsp;</span>However, there is no serialization associated with reads or updates.<spanstyle="mso-spacerun: yes">&nbsp; </span>Rather, serialization is invoked uponloading the region from a snapshot, and also when writing shaphots and redologs out to files.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Notethat stating that the entire map&lt;&gt; must fit into memory is true in thesense that the entire map must be instantiated in the address space of one memorypool.<span style="mso-spacerun: yes">&nbsp; </span>However, since some memorypool implementations are based on a resizable mmap, which is part of thevirtual address subsystem of the OS, and thus can grow to be larger than theavailable physical memory of the node.<span style="mso-spacerun: yes">&nbsp;</span>If this is done, the paging of that mmap is essentially left to theOS.<span style="mso-spacerun: yes">&nbsp; </span>(Results may vary).<spanstyle="mso-spacerun: yes">&nbsp; </span>The mmap in that case will competealong with applications for the right to have physical memory, and this mayactually be an ideal case.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:16.0pt;font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:16.0pt;font-family:Helvetica'><b>Contained Object Requirements:</b></span><spanstyle='font-size:16.0pt;font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Oncewe start using the STL container as the implementation of a ‘table’ in adatabase, the types stored in it must meet certain criteria to be used in thisway:<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-pagination:none;mso-list:l8 level1 lfo8;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>It could be a concretetype, permitting it to be allocated and stored within the container.<spanstyle="mso-spacerun: yes">&nbsp; </span>In this case, the type will also need acopy constructor so that copies can be returned via the APIs.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-pagination:none;mso-list:l8 level1 lfo8;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>If the non-concretetype can also take the Allocator parameter, permitting the object to be createdin shared memory.<span style="mso-spacerun: yes">&nbsp; </span>In this case,the type has to have a copy constructor so that copies can be returned viaAPIs.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-pagination:none;mso-list:l8 level1 lfo8;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>Finally if the datatype is not concrete, and also can’t handle all dynamic allocation using theSTL allocator interface, then the object type can’t be stored directly in thecontainer.<span style="mso-spacerun: yes">&nbsp; </span>Rather some kind ofserialized version of the object’s state will have to be stored.<spanstyle="mso-spacerun: yes">&nbsp; </span>As a general strategy for supportingobject serialization at multiple points in the design, the boost serializationlibrary will be used.<span style="mso-spacerun: yes">&nbsp; </span>A containerwhich serializes and deserializes the data that it contains can be provided asa subclass of the container type which works directly with the contained objecttype.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:16.0pt;font-family:Helvetica'><b>Opening a database, and its tables:</b></span><spanstyle='font-size:16.0pt;font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>I'musing the term database here to refer to a set of tables which are always usedtogether.<span style="mso-spacerun: yes">&nbsp; </span>Put in terms of STLshm,a database would be a shared memory pool object, managed via some malloc()algorithm, which contains one or more STL containers, along with some otherstandard containers that are used for transactions, etc. by the databasemechanism itself.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Adatabase is the maximum data set that can be affected by one transaction.<spanstyle="mso-spacerun: yes">&nbsp; </span>A database contains one or more tables.<spanstyle="mso-spacerun: yes">&nbsp; </span>Tables are STL-like containerscontaining key/value pairs.<span style="mso-spacerun: yes">&nbsp; </span>Indexesare STL-like containers containing key/key pairs, mapping a secondary key toone or more primary keys.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Thedatabase, on disk, consists of a small file defining the database, plus one ormore files containing the data for the tables, more files for the indexes, andalso transactional log files.<span style="mso-spacerun: yes">&nbsp; </span>Aclean shutdown yields no logs files (they all get archived.)<spanstyle="mso-spacerun: yes">&nbsp; </span>The small file for the databaseidentifies the last committed transaction in the snapshots, and the inventoryof tables in the database at the time of the last snapshot.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Inopening the database, the ACE Memory Pool is created, or re-opened.<spanstyle="mso-spacerun: yes">&nbsp; </span>Once this much is done, each table thatis within the environment is then opened.<span style="mso-spacerun: yes">&nbsp;</span>The process of opening the tables start by reading in the last snapshotfile for that table.<span style="mso-spacerun: yes">&nbsp; </span>(This can beempty when the table is first created.)<span style="mso-spacerun: yes">&nbsp;</span>The process of loading the table is essentially a bulk loading technique- lots of sequential I/O, deserialization, and insertion of records into thememory table.<span style="mso-spacerun: yes">&nbsp; </span>The disk image of atable is essentially just a sequence of key/value pairs.<spanstyle="mso-spacerun: yes">&nbsp;&nbsp; </span>The entire data set is loadedinto memory by the open() operation.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Onceall snapshots have been loaded, the system then has to check for log filesindicating some form of recovery being needed.<span style="mso-spacerun:yes">&nbsp; </span>If logs have been left over since the last snapshot, thenall operations that are in the logs with a trasacton ID greater than the one inthe database file must be read from the logs and re-applied.<spanstyle="mso-spacerun: yes">&nbsp; </span>This constitutes recovery of alltransactions which occurred after the last successful snapshot.<spanstyle="mso-spacerun: yes">&nbsp; </span>When any recovery has been completed,the database is now up to date and ready for use.<span style="mso-spacerun:yes">&nbsp; </span>The logs aren't deleted at this point - the next snapshotwill begin the normal process of log removal.<span style="mso-spacerun:yes">&nbsp; </span>If the database is shot down correctly this time, the logswill end up deleted, and the snapshot current.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:16.0pt;font-family:Helvetica'><b>Starting Transactions:</b></span><spanstyle='font-size:16.0pt;font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>EachMemory Pool contains one or more tables.<span style="mso-spacerun: yes">&nbsp;</span>It also has some other allocated objects, which include the following:<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-pagination:none;mso-list:l6 level1 lfo9;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>A transactioncounter, indicating the last committed transaction.<span style="mso-spacerun:yes">&nbsp; </span>These are assigned to an in-progress transaction at the timeof commit.<span style="mso-spacerun: yes">&nbsp; </span>This is the value thatis also in the persisted file.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-pagination:none;mso-list:l6 level1 lfo9;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>An in-progresstransaction counter, used to assign an initial numeric ID to a transaction whenit is started.<span style="mso-spacerun: yes">&nbsp; </span>This is used as alock value in the shared memory region.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-pagination:none;mso-list:l6 level1 lfo9;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>The list of known,in-progress transactions (an inventory may be helpful for live recoveryscenarios.)<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-pagination:none;mso-list:l6 level1 lfo9;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>The pids ofconnected processes.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Whena transaction is started against a container, the process requesting thetransaction is assigned a lock_Id.<span style="mso-spacerun: yes">&nbsp;</span>This isn't the same as the ID that the committed transaction will havewhen its operations are all written to the log.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Whena transaction is received in this way, a set of transaction structures are alsocreated in the processes global memory.<span style="mso-spacerun: yes">&nbsp;</span>This is used to keep track of changes made (but not yet committed) inthe scope of that transaction.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:16.0pt;font-family:Helvetica'><b>Read Operations:</b></span><span style='font-size:16.0pt;font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Readsare pretty straightforward:<span style="mso-spacerun: yes">&nbsp; </span>Theprocess gets a read lock on the STL container, which is very short lived.<spanstyle="mso-spacerun: yes">&nbsp; </span>It pulls the data from the STLcontainer.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Whendata is read, if the data has a lock_id, the reader still returns the content,unless the ver_nbr is 0 on the data (that would indicate that the data is anuncommitted insert, as explained below.)<span style="mso-spacerun: yes">&nbsp;</span>If the lock_id is the same as the one being used to perform the readoperation, then the modified record in global memory would be read and returnedinstead.<span style="mso-spacerun: yes">&nbsp; </span>This means that theprocess is re-reading data that they have already modified in the transaction.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>Insertoperations:<o:p></o:p></b></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Whena row is inserted, a lock is acquired on the STL container, and the new row isinserted.<span style="mso-spacerun: yes">&nbsp; </span>It is inserted with thelock_id set to the value of the transacton, and the ver_nbr is set to 0.<spanstyle="mso-spacerun: yes">&nbsp; </span>The data in this case can be on the rowput into shared memory.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Inglobal memory, a record indicating the insert is added to the global memorytransaction log.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Ifa row is found which has a different lock_id and a ver_nbr of 0, then theinsert has to block until that transaction committs.<span style="mso-spacerun:yes">&nbsp; </span>If one is found with a lock_id and a ver_nbr of 1+, of ifthe existing row has a lock_id of 0, then the insert should fail witha duplicatekey constraint.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>Updateoperations:<o:p></o:p></b></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></b></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Whenan update is done, a lock is acquired on the STL container, and ONLY thelock_id on the row being modified is set.<span style="mso-spacerun: yes">&nbsp;</span>The updated row is put into the global memory.<span style="mso-spacerun:yes">&nbsp; </span>The copy in global memory has an updated version_num(incremented).<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Ifthe row being updated has a different lock_id then the process must wait untilthat lock is released before the update can be done.<span style="mso-spacerun:yes">&nbsp; </span>If one is found with a ver_nbr of 0, or if no row is foundthen the update should fail.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>Deleteoperations:</b></span><span style='font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Whenthe delete is done, the row is marked with a lock_id as per an update.<spanstyle="mso-spacerun: yes">&nbsp; </span>In global memory, a record of thedelete is recorded.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Ifthe row being updated has a different lock_id then the process must wait untilthat lock is released before the delete can be done.<span style="mso-spacerun:yes">&nbsp; </span>If one is found with a ver_nbr of 0, or if no row is foundthen the update should fail.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>Rollbackof a transaction:</b></span><span style='font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Whena rollback is done, the process has to go through the list of records that ithas locked, and remove the lock_id value (set it back to 0).<spanstyle="mso-spacerun: yes">&nbsp; </span>If it inserted any records, they mustbe deleted.<span style="mso-spacerun: yes">&nbsp; </span>The global dataassociated with the transaction is then deleted.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>Committinga transaction:</b></span><span style='font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Whena commit is done, the set of changes associated with the transaction aregrouped into tables according to a table number.<span style="mso-spacerun:yes">&nbsp; </span>Then for each table, the commit locks the STL container, andproceeds to do the operations against that table.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.5in;mso-text-indent-alt:-.5in;mso-pagination:none;mso-list:l3 level1 lfo4;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>0.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>For inserts, thelock_id is set back to 0, and the ver_nbr incremented to 1.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.5in;mso-text-indent-alt:-.5in;mso-pagination:none;mso-list:l3 level1 lfo4;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>0.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>For updates, thelock_id is set back to 0, the ver_nbr is incremented, and the data is chaned tomatch what is in global memory.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.5in;mso-text-indent-alt:-.5in;mso-pagination:none;mso-list:l3 level1 lfo4;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>0.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>For deletes, therow is removed from the STL.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Whenthe operations have been done to all tables, the locks can then be released.<spanstyle="mso-spacerun: yes">&nbsp; </span>When released, the transaction has justatomically been made visible to other threads.<span style="mso-spacerun:yes">&nbsp; </span>However, at this point, it is guaranted to be durable yet,so the commit doesn't return.<span style="mso-spacerun: yes">&nbsp; </span>Notyet...<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Atthis point, the process then gets the next available comitted transacton IDfrom the database.<span style="mso-spacerun: yes">&nbsp; </span>This alsoacquires a lock on the commit buffer.<span style="mso-spacerun: yes">&nbsp;</span>It writes its set of operations to the commit buffer, and then flushesit to disk.<span style="mso-spacerun: yes">&nbsp; </span>It can then releasethe lock.<span style="mso-spacerun: yes">&nbsp; </span>At this point, thetransaction has been made durable. <span style="mso-spacerun:yes">&nbsp;</span>Committs are essential single-threaded.<spanstyle="mso-spacerun: yes">&nbsp; </span>There may be some clever ways to makethe commits aggregate disk I/O when multiple threads want to do simultaneouscommits.<span style="mso-spacerun: yes">&nbsp; </span>tbd...<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Closinga database.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>TheN-1 process which close the database first don't have to do any extra I/O, theyjust confirm that they have no outstanding transactions, and disconnect.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Thelast process to leave does a database snapshot, and can then archive all logs.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>Snapshotof a database:</b></span><span style='font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Snap-shottingthe database involves at first capturing the last committed transaction Id atthe start of the operation.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Theprocess can then begin writing out tables, either one at a time, or with somedegree of parallelism.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Theprocess of writing out the table involves iterating through it, capturing Nrecords of data from it at a time, and then writing their key/data pairs outusing a buffer.<span style="mso-spacerun: yes">&nbsp; </span>After each set ofN are copied out (with a read lock held), the lock on the<spanstyle="mso-spacerun: yes">&nbsp; </span>STL is released, and then the write isdone.<span style="mso-spacerun: yes">&nbsp; </span>N can be fairly small.<spanstyle="mso-spacerun: yes">&nbsp; </span>The way that the snapshot will continuethe write after re-acquiring the lock is to search for the last key which wasfound, iterate forward one past that, and then continue with the next N rows.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Ifnecessary, the snapshot thread can lock the row (set lock_id) in between STLlocks to insure that the iteration at that point doesn't break anything.<spanstyle="mso-spacerun: yes">&nbsp; </span>That may an effective technique at somepoint the future for allowing iterators to be used on the container contents.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><i>ImprovingSnapshot performance:</i></span><span style='font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Oneof the disadvantages of the proposed snapshot type is that the entire databaseis written back to disk, every time that there is a snapshot.<spanstyle="mso-spacerun: yes">&nbsp; </span>What if the table only has a fewchanges in it since its last checkpoint? In that case, the process of writingout all data involves a lot of waste.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Asolution to this is a technique like incremental backups.<spanstyle="mso-spacerun: yes">&nbsp; </span>The data in the table would be markedwith a 'dirty bit', indicating that it had changed since the last checkpoint.<spanstyle="mso-spacerun: yes">&nbsp;&nbsp; </span>A last committed transaction_idcan do roughly the same.<span style="mso-spacerun: yes">&nbsp; </span>When rowsare modified, an intrinsic linked list keeps track of those rows of data whichhave seen modification.<span style="mso-spacerun: yes">&nbsp; </span>Inaddition, each table would track:<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.5in;mso-text-indent-alt:-.5in;mso-pagination:none;mso-list:l4 level1 lfo5;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>0.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>The transaction_idof the last full snapshot.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.5in;mso-text-indent-alt:-.5in;mso-pagination:none;mso-list:l4 level1 lfo5;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>0.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>The transaction_idof the last incremental snapshot.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.5in;mso-text-indent-alt:-.5in;mso-pagination:none;mso-list:l4 level1 lfo5;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>0.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>The number of rowsmodified since the last full snapshot.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.5in;mso-text-indent-alt:-.5in;mso-pagination:none;mso-list:l4 level1 lfo5;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>0.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>The total number ofrows in the table.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Theidea is somewhat simple:<span style="mso-spacerun: yes">&nbsp; </span>When thetable is first created, it gets an empty 'full snapshot', created at the timeof the transaction which creates the table.<span style="mso-spacerun:yes">&nbsp; </span>Thereafter, as rows are added, the total row count andchanged rows since last snapshot are tracked.<span style="mso-spacerun:yes">&nbsp; </span>When the tables is evaluated for snapshotting, the routinelooks at the ration of modified rows since last snashot vs. total rows.<spanstyle="mso-spacerun: yes">&nbsp; </span>If that ration is greater than anarbitrary percentage, then it figures it is time to write out a a brand newcomplete snapshot of the table, and remove the previous snapshot, and anyapplicable logs.<span style="mso-spacerun: yes">&nbsp; </span>If however, thepercentage of &quot;dirty&quot; records is still fairly low, then the snapshotroutine writes out a seperate incremental file which contains only thoserecords modified since the last full snapshot.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Thisstrategy can help reduce the amount of time spent writing out clean data.<spanstyle="mso-spacerun: yes">&nbsp; </span>It particularly benefits tables whichhave a limited amount of data that is modified (i.e. good locality), becausethe routine wil keep writing out a new incremental until the percentage of datamodified is high enough.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Eachtime an incremental snapshot is written, all data modified since the last fullsnapshot (note: NOT all data modified since the last incremental) is writteninto a new incremental snapshot file.<span style="mso-spacerun: yes">&nbsp;</span>Once that is done for all tables in the database, the standard logarchiving can then be done.<span style="mso-spacerun: yes">&nbsp; </span>Thecount of modified bits, and their associated dirty bits, is not cleared.<spanstyle="mso-spacerun: yes">&nbsp; </span>In this way, as rows continue to bemodified, the table will gradually accumulate enough changes to warrant a newcomplete snapshot.<span style="mso-spacerun: yes">&nbsp; </span>Whenever thenext full snapshot is done, any incremental snapshot in place at the time isdeleted.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Thisconcept presents an interesting possibility for multiple levels of iterativesnapshotting.<span style="mso-spacerun: yes">&nbsp; </span>There is a level-0full snapshot, a level-1 incremental snapshot which is used when &lt;50% of thedata is modified.<span style="mso-spacerun: yes">&nbsp; </span>Then there isanother eve-2 incremental snapshot when the modifications to the data since thelast level-1 incremental is &lt;50% (i.e. &lt;25% of the total) and so on.<spanstyle="mso-spacerun: yes">&nbsp;&nbsp; </span>This could be applied like abinary tree in which case the total disk occupancy from the hierarchy ofsnapshots is less than 2 times the database size.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></b></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>ResearchTo-Do:</b></span><span style='font-family:Helvetica'><span style="mso-spacerun:yes">&nbsp; </span>I need to take a serious look at how STL iterators have beenused in multi-threaded applications.<span style="mso-spacerun: yes">&nbsp;</span>i.e. strategies for it.<span style="mso-spacerun: yes">&nbsp;</span>That in turn would lead to the possibility for cursors.<spanstyle="mso-spacerun: yes">&nbsp; </span>In general, this might work if Iimplement row-level read locks, and have the cursor and/or snapshot only hold aread-lock on that row.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></b></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>Handlingthe need to block due to transaction lock_id contention:</b></span><spanstyle='font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Eachtransaction that is started has a condition_variable in global memory which theprocess wanting to do the update can sleep on.<span style="mso-spacerun:yes">&nbsp; </span>When a process committs its transaction, it does a broadcastsignal to all other processes/threads waiting on that condition variable.<spanstyle="mso-spacerun: yes">&nbsp; </span>And that is basically about it.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>Indexes:</b></span><spanstyle='font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Everytable encapsulates its primary key, and every table has a unique primarykey.<span style="mso-spacerun: yes">&nbsp; </span>The secondary indexes caninclude non-unique keys.<span style="mso-spacerun: yes">&nbsp; </span>A keyextractor relates the secondary index to its primary, allowing appropriatemanipulation of the secondary when the primary is updated.<spanstyle="mso-spacerun: yes">&nbsp; </span>Direct manipulation of the indexes isNOT possible.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Queryagainst the secondary index returns the data, and can also optionally returnthe primary key.<span style="mso-spacerun: yes">&nbsp; </span>Effectively ajoin between index and main table is done by the API.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>ToSummarize some points regarding Transactions:</b></span><span style='font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Someconsiderations:<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.5in;mso-text-indent-alt:-.5in;mso-pagination:none;mso-list:l5 level1 lfo6;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>0.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>Every thread whichperforms a write operation against an STL container would need its owntransactional context.<span style="mso-spacerun: yes">&nbsp; </span>Thiscontext is acquired when the transaction starts, and is passed in when thetransaction is committed.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.5in;mso-text-indent-alt:-.5in;mso-pagination:none;mso-list:l5 level1 lfo6;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>0.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>Transactionalchanges are kept in local (heap) memory until those transactions arecommitted.<span style="mso-spacerun: yes">&nbsp; </span>Thus, the onlylong-held locks possible against the data structure occur when the commit() isbeing done.<span style="mso-spacerun: yes">&nbsp; </span>Once the commit isstarted, the application then acquires true write locks (mutex locks) againstthe data structures.<span style="mso-spacerun: yes">&nbsp;&nbsp; </span>Untilthe commit is done, the application only acquires write locks briefly, and oneat a time, to mark a row of data as being write-locked in the scope of atransaction.<span style="mso-spacerun: yes">&nbsp; </span>This is enough toprevent other writers from updating the record, but it also allows readers toalways see the last committed operation.<span style="mso-spacerun: yes">&nbsp;</span>Thus, MVCC.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.5in;mso-text-indent-alt:-.5in;mso-pagination:none;mso-list:l5 level1 lfo6;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>0.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>If an app re-readsits own uncommitted changes, it sees the write lock and transaction_id on therow in the shared memory store, which allows the API to fetch and return themore recent modified version from heap memory, so not issue of isolation /consistency occurs.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.5in;mso-text-indent-alt:-.5in;mso-pagination:none;mso-list:l5 level1 lfo6;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>0.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>No long durationread-locks are possible.<span style="mso-spacerun: yes">&nbsp;</span>Repeatable reads are not guaranteed.<span style="mso-spacerun:yes">&nbsp; </span>(Thought of a way to do this, there just doesn't seem to beenough of a need.)<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.5in;mso-text-indent-alt:-.5in;mso-pagination:none;mso-list:l5 level1 lfo6;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>0.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>TransactionalLogging will be ensured by writing out a 'redo' log, which in this case onlyneeds to be implemented with the data changes that are committed, not the oldversions prior to the commit (for undo).<span style="mso-spacerun: yes">&nbsp;</span>The reason for this is because you never see uncommitted changes evergetting paged out or written out by snapshots.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.5in;mso-text-indent-alt:-.5in;mso-pagination:none;mso-list:l5 level1 lfo6;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>0.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'>The snap-shottingtechnology used to write out the STL container to disk sees only the committedinformation that is in shared memory.<span style="mso-spacerun: yes">&nbsp;</span>It does need to know also what the latest committed transaction Id isfor the database (al tables), so that corresponding log files with an earliernumbering can be removed (or moved to an archive directory)<spanstyle="mso-spacerun: yes">&nbsp; </span>Snapshotting involves writing out alltables in the database serially or in parallel, and then considering alltransactions committed from the moment the snapshot began to have beenpersisted.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.5in;mso-text-indent-alt:-.5in;mso-pagination:none;mso-list:l5 level1 lfo6;tab-stops:11.0pt .5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-family:Helvetica'>0.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>ACIDproperties, and how they are met:</b></span><span style='font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>Atomic:</b></span><spanstyle='font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Thebtree, hash table, etc. structure that is in-memory is guarded by a singleread/write lock which the writers must acquire to make changes to thecontent.<span style="mso-spacerun: yes">&nbsp; </span>When a commit happens,the lock is acquired on each table in the database in turn in order to allowthe individual changes to be written to shared memory, and the associatedtransaction_id (write lock) on the record to be cleared.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Thisapproach means that readers can guarantee 'repeatable reads' - an isolationlevel offered by fully ACID compliant DBs.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>Concurrent:</b></span><spanstyle='font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Theread/write lock, and the strategy of only indicating a write lock on the dataobject, and not holding long-running locks, is important to concurrency.<spanstyle="mso-spacerun: yes">&nbsp;&nbsp; </span>The store should demonstratehighly concurrent, MVCC behavior.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Note:When inserting a new record into a hash-table, the insert may have to happenimmediately, after which the inserted record is marked as locked, and has aversion number of 0.<span style="mso-spacerun: yes">&nbsp; </span>When thecommit is done, the lock is released, and the record then becomes visible toall users.<span style="mso-spacerun: yes">&nbsp; </span>This is the one casewhere uncommitted data is visible in shared memory.<span style="mso-spacerun:yes">&nbsp; </span>Both query methods and the snapshot mechanism would need tobe aware of it.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>Isolation:</b></span><spanstyle='font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Transactionswhich write to a store hold their modifications in global memory until thecommit() is done.<span style="mso-spacerun: yes">&nbsp; </span>In this way,readers are not blocked by writers.<span style="mso-spacerun: yes">&nbsp;&nbsp;</span>&quot;Read Consistent&quot; views of the data are not possible.<spanstyle="mso-spacerun: yes">&nbsp; </span>However, they could be implemented byhaving a shared memory repository that is associated with the transaction thatrequires the read-consistent view.<span style="mso-spacerun: yes">&nbsp;</span>When the application starts reading data, it joins a list of threadswhich have a maximum transaction ID.<span style="mso-spacerun: yes">&nbsp;</span>Whenever an existing row in a table which has a transaction ID &lt; aread-consistent threads maximum transaction ID, that piece of data (the oldview) must be copied into an 'old' copy of the data in a separate STLcontainer.<span style="mso-spacerun: yes">&nbsp; </span>This old container iscleaned out as the real-isolated transactions are committed and the smallestmaximum transaction Id value creeps forward.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Toprovide a level of isolation, I need atomic operations which can be done in thescope of a single STL container read-lock, like fetching all the rows with apartial key value, or between a pair of key values, and so on.<spanstyle="mso-spacerun: yes">&nbsp; </span>Isolation rules don't apply acrossmultiple calls - each new API call presents the chance of the app seeing somenew comitted data.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Ingeneral, I don't think we really need consistent reads.<spanstyle="mso-spacerun: yes">&nbsp; </span>It's a formality of the ACID rules, butI have never seen anyone ever set Oracle to provide read-consistent views for atransaction.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>Durability:</b></span><spanstyle='font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Providedvia combination of write ahead logging with occasional snapshot.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Noteon Snapshot Efficiency:<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Thesnapshot process has to go over the STL container, which presents the risk of along-held read-lock.<span style="mso-spacerun: yes">&nbsp; </span>It uses aread-lock on the STL container, along with a corresponding iterator.<spanstyle="mso-spacerun: yes">&nbsp; </span>All it does, with each iteration ismove forward to the next item in the container, read its contents, and copythose to a write buffer destined for the snapshot file.<spanstyle="mso-spacerun: yes">&nbsp; </span>The data copied is always committedinformation.<span style="mso-spacerun: yes">&nbsp; </span>The process holds itsread-lock long enough to get some set of 'N' records copied in this way (frommemory to memory), and then releases it.<span style="mso-spacerun: yes">&nbsp;</span>This helps to ensure that the snapshot process does not block writersindefinitely.<span style="mso-spacerun: yes">&nbsp; </span>It also means thatin between read lock acquisitions, the process must have some fairly reliableway of skipping forward through the STL structure.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Asrequired, when the snapshot process fills up the buffer via these copies, thebuffer is then written to disk.<span style="mso-spacerun: yes">&nbsp;&nbsp;</span>Only once the whole buffer is written to disk successfully is a recordaddd to the end of the snapshot (or to the start of the file) indicating thecompletion of the snapshot.<span style="mso-spacerun: yes">&nbsp; </span>If thesnapshot is interrupted, the whole thing is thrown away, and the latest oneprior to the failed snapshot is used instead.<span style="mso-spacerun:yes">&nbsp; </span>One of the acts upon completing the whole snapshot would beto archive the prior snapshot instance.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b>Replication&amp; Hot Stand-by Approaches:</b></span><span style='font-family:Helvetica'><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Thestand-by is usable, but read-only.<span style="mso-spacerun: yes">&nbsp;</span>It tails the log written by the master, and applies all changesseen.<span style="mso-spacerun: yes">&nbsp; </span>When a master dies, aprocess makes that determination and writes a 'time of death' marker to themasters log, signaling to the stand-by that when it sees that it should switchto a master mode and become writable.<span style="mso-spacerun: yes">&nbsp;</span>This transition would be close to instantaneous.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Limitingreplication to master/stand-by pairs.<span style="mso-spacerun: yes">&nbsp;</span>2 nodes only.<span style="mso-spacerun: yes">&nbsp; </span>If a masterdies, when rebooted, it can join the environment again as the new sand-by, andthen catch up with the stuff in the master nodes logs.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Needto make sure log archiving somehow takes into account whether the stand-by isrunning behind in this way.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b><u><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></u></b></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><b><u>PLAN:<o:p></o:p></u></b></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Sincethe data structure in shared memory will ultimately be based on an STLcontainer occupying a shared memory segment, I could initially work on most ofthese ACID / transaction issues by working on the STL containers (APIs) instandard heap memory - i.e. just base things initially off multi-threaded testapps accessing a global memory STL container.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'>Startoff also with simple concrete types, so that when data is put into thecontainer, the copying in/out can be based on the simple use of the copy constructors.<o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal style='mso-pagination:none;tab-stops:.5in 1.0in 1.5in 2.0in 2.5in 3.0in 3.5in 4.0in 4.5in 5.0in 5.5in 6.0in;mso-layout-grid-align:none;text-autospace:none'><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal><span style='font-family:Helvetica'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p></div></body></html>